import React, { useEffect, useRef, useState } from "react";
import Head from "next/head";
import styles from "../styles/Home.module.css";
import Header from "../component/Header";
import Footer from "../component/Footer";
import Ticket from "../component/Ticket";
import { billets } from "../component/Data";
import ButtonGrid from "../component/ButtonGrid";
import { AgGridReact } from "ag-grid-react";
import "ag-grid-community/styles//ag-grid.css";
import "ag-grid-community/styles//ag-theme-alpine.css";
import axios from "axios";

export default function Tickets() {
  const [colDefs, setColDefs] = useState([
    {
      field: "number",
      minWidth: 300,
    },
    {
      field: "update",
      minWidth: 300,
    },
    {
      field: "creat",
      minWidth: 200,
      cellRenderer: ButtonGrid,
    },
  ]);
  const [alltickets, setAlltickets] = useState([]);
  const [width, setWidth] = useState(0);
  const [role, setRole] = useState(null);

  const [open, setOpen] = React.useState(false);
  const toggleDrawer = (newOpen) => () => {
    setOpen(newOpen);
  };

  const updateDimensions = () => {
    setWidth(window.innerWidth);
    localStorage.setItem("width", width);
  };

  useEffect(() => {
    updateDimensions();
    window.addEventListener("resize", updateDimensions);
    return () => window.removeEventListener("resize", updateDimensions);
  }, [width]);

  console.log("width", width);
  useEffect(() => {
    getAlltickets();
  }, []);

  const getAlltickets = async () => {
    //fonction pour crÃ©er un ticket
    const token = localStorage.getItem("token");
    const id = localStorage.getItem("refresh");

    const config = {
      headers: { Authorization: `Bearer ${token}` },
    };

    const body = {
      idClient: id,
    };

    const api =
      "https://api.dev.dsp-archiwebo21-ct-df-an-cd.fr/ticket/tickets-by-client";

    try {
      let Alltickets = await axios.post(api, body, config);
      console.log("Alltickets", Alltickets);
      const newTickets = Alltickets.data.map((a) => {
        return {
          number: a.ticketNumber,
          creat: a.createdAt,
          update: a.updatedAt,
        };
      });

      setAlltickets(newTickets);
    } catch (e) {
      console.log(e);
    }
  };
  const number = billets.length;
  console.log(billets);
  return (
    <div className={styles.container}>
      <Head>
        <title>TeaBingo - Jeux concours</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/fav.png" />
      </Head>
      <Header />
      <h1 className={styles.h1}>Mes tickets</h1>
      <p style={{ fontSize: 18, color: "grey" }}>
        Vous avez{" "}
        <strong style={{ color: "#41D8C2" }}>{alltickets.length} </strong>
        {`tickets gagnants`}
      </p>
      <div style={stylez.gain}>
        <div
          className="ag-theme-alpine"
          style={{
            height: "800px",
            width: width < 650 ? "90%" : 800,
          }}
        >
          <AgGridReact
            pagination={true}
            rowData={alltickets}
            columnDefs={colDefs}
          ></AgGridReact>
        </div>
      </div>
      <Footer />
    </div>
  );
}

const stylez = {
  gain: {
    display: "flex",
    flexDirection: "column",
    alignItems: "center",
    width: "100vw",
    minHeight: "100vh",
  },
};
